import{j as O,r as b,B as h,d as x,c as y,o as v,m as $,C as N,a as m,t as S,n as B,u as j,i as A,e as L}from"./index-D6er3wSj.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te=()=>{const r=O(),n=b([]),a=b(!1),i=b(null),p=async e=>{try{const t=e.name.split(".").pop(),o=`properties/${`${Date.now()}-${Math.random().toString(36).substring(2,9)}.${t}`}`,{error:u}=await h.storage.from("property-images").upload(o,e);if(u)throw u;const{data:{publicUrl:s}}=h.storage.from("property-images").getPublicUrl(o);return s}catch(t){throw console.error("Ошибка загрузки изображения:",t),t}},g=async(e={})=>{try{a.value=!0,i.value=null;let t=h.from("properties").select("*").order("created_at",{ascending:!1});e.excludeId&&(t=t.neq("id",e.excludeId)),e.location&&(t=t.ilike("location",`%${e.location}%`)),e.limit&&(t=t.limit(e.limit));const{data:l,error:o}=await t;if(o)throw o;const u=(Array.isArray(l)?l:[]).map(_);return e.returnOnly||(n.value=u),u}catch(t){throw i.value=t.message,n.value=[],t}finally{a.value=!1}},w=async e=>{try{a.value=!0,i.value=null;const{data:t,error:l}=await h.from("properties").select("*").eq("id",e).single();if(l)throw l;return _(t)}catch(t){throw i.value=t.message,t}finally{a.value=!1}},_=e=>{if(!e)return null;let t=[];if(Array.isArray(e.images))t=e.images;else if(typeof e.images=="string")try{const l=e.images.replace(/\\/g,"");t=JSON.parse(l)}catch{t=[]}return{title:e.title||"Без названия",description:e.description||"",price:e.price||0,location:e.location||"Не указано",images:t,type:e.type||"apartment",id:e.id||"",user_id:e.user_id||"",created_at:e.created_at||new Date().toISOString()}};return{properties:n,isLoading:a,error:i,fetchProperties:g,fetchPropertyById:w,addProperty:async e=>{var t;try{if(a.value=!0,i.value=null,!((t=r.user)!=null&&t.id))throw new Error("Требуется аутентификация");const{id:l,created_at:o,updated_at:u,...s}=e,c=[];for(const f of s.images||[])if(typeof f=="string")c.push(f);else if(f instanceof File||f instanceof Blob)try{const E=await p(f);c.push(E)}catch(E){console.error("Не удалось загрузить изображение:",E)}const d={title:s.title,description:s.description,price:Number(s.price)||0,location:s.location,type:s.type||"apartment",images:c.length>0?c:null,user_id:r.user.id};Object.keys(d).forEach(f=>{(d[f]===void 0||d[f]===null)&&delete d[f]});const{data:P,error:z}=await h.from("properties").insert(d).select().single();if(z)throw z;return await g(),P}catch(l){throw i.value=l.message,console.error("Full error details:",l),l}finally{a.value=!1}},updateProperty:async e=>{var t;try{if(a.value=!0,i.value=null,!((t=r.user)!=null&&t.id))throw new Error("Требуется аутентификация");if(!(e!=null&&e.id))throw new Error("ID свойства обязательно");const l=[];for(const c of e.images)if(typeof c=="string")l.push(c);else try{const d=await p(c);l.push(d)}catch(d){console.error("Не удалось загрузить изображение:",d);continue}const{data:o,error:u}=await h.from("properties").update({title:e.title,description:e.description,price:Number(e.price),location:e.location,images:l,updated_at:new Date().toISOString()}).eq("id",e.id).eq("user_id",r.user.id).select().single();if(u)throw u;const s=n.value.findIndex(c=>c.id===e.id);return s!==-1&&(n.value[s]=o),o}catch(l){throw i.value=l.message,l}finally{a.value=!1}},deleteProperty:async e=>{var t,l;try{if(a.value=!0,i.value=null,!((t=r.user)!=null&&t.id))throw new Error("Требуется аутентификация");const o=n.value.find(s=>s.id===e);if(!o)throw new Error("Свойство не найдено");if(((l=o.images)==null?void 0:l.length)>0){const s=o.images.map(d=>{const P=d.split("/");return`properties/${P[P.length-1]}`}),{error:c}=await h.storage.from("property-images").remove(s);if(c)throw c}const{error:u}=await h.from("properties").delete().eq("id",e).eq("user_id",r.user.id);if(u)throw u;return n.value=n.value.filter(s=>s.id!==e),!0}catch(o){throw i.value=o.message,o}finally{a.value=!1}}}},U={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 400 300",class:"w-full h-full"},F=["fill"],M=["fill","font-size"],V=["src","alt"],R={__name:"PlaceholderImage",props:{src:String,alt:{type:String,default:"Property image"},size:{type:String,default:"md",validator:r=>["xs","sm","md","lg","xl","full"].includes(r)},text:{type:String,default:"No Image"},backgroundColor:{type:String,default:"#e5e7eb"},textColor:{type:String,default:"#6b7280"},textSize:{type:[String,Number],default:20},loading:{type:Boolean,default:!1},rounded:{type:String,default:"md",validator:r=>["none","sm","md","lg","full"].includes(r)}},emits:["load","error"],setup(r,{emit:n}){const a=r,i=n,p=b(!1),g=b(!1),w=x(()=>!a.src||a.loading||p.value),_=x(()=>({xs:"w-16 h-12",sm:"w-32 h-24",md:"w-48 h-36",lg:"w-64 h-48",xl:"w-80 h-60",full:"w-full h-full"})[a.size]),C=x(()=>({none:"rounded-none",sm:"rounded-sm",md:"rounded-md",lg:"rounded-lg",full:"rounded-full"})[a.rounded]),I=x(()=>a.backgroundColor.startsWith("#")?a.backgroundColor:`var(--color-${a.backgroundColor.replace("bg-","").replace("-","/")})`),k=x(()=>a.textColor.startsWith("#")?a.textColor:`var(--color-${a.textColor.replace("text-","").replace("-","/")})`),e=()=>{g.value=!0,i("load")},t=()=>{p.value=!0,i("error")};return(l,o)=>(v(),y("div",{class:B(["placeholder-image relative",[_.value,C.value,{"animate-pulse":r.loading}]])},[w.value?(v(),y("svg",U,[m("rect",{width:"400",height:"300",fill:I.value},null,8,F),m("text",{x:"50%",y:"50%","dominant-baseline":"middle","text-anchor":"middle","font-family":"sans-serif",fill:k.value,"font-size":r.textSize},S(r.text),9,M)])):$("",!0),!w.value&&r.src?(v(),y("img",{key:1,src:r.src,alt:r.alt,class:B(["absolute inset-0 w-full h-full object-cover",C.value]),onLoad:e,onError:t},null,42,V)):$("",!0),!w.value&&!r.src?N(l.$slots,"default",{key:2},void 0):$("",!0)],2))}},W=q(R,[["__scopeId","data-v-104249f5"]]),J={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-4 h-4 mr-1 text-gray-400"},T=Object.assign({name:"LocationIcon"},{__name:"LocationIcon",setup(r){return(n,a)=>(v(),y("svg",J,a[0]||(a[0]=[m("path",{"fill-rule":"evenodd",d:"M11.54 22.351l.07.04.028.016a.76.76 0 00.723 0l.028-.015.071-.041a16.975 16.975 0 001.144-.742 19.58 19.58 0 002.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 00-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 002.682 2.282 16.975 16.975 0 001.145.742zM12 13.5a3 3 0 100-6 3 3 0 000 6z","clip-rule":"evenodd"},null,-1)])))}}),G={class:"relative aspect-[4/3] overflow-hidden rounded-t-lg"},H=["src","alt"],K={class:"p-4"},Q={class:"text-lg font-semibold"},X={class:"flex items-center text-gray-500 mt-1"},Y={class:"mt-2 text-blue-600 font-bold"},Z={__name:"PropertyCard",props:{property:{type:Object,required:!0,default:()=>({title:"",description:"",price:0,location:"",images:[],id:""})}},setup(r){const n=r,a=j(),i=()=>{n.property.id&&a.push({name:"PropertyDetail",params:{id:n.property.id}})},p=g=>new Intl.NumberFormat("ru-RU").format(g||0);return(g,w)=>(v(),y("div",{class:"property-card",onClick:i},[m("div",G,[!r.property.images||r.property.images.length===0?(v(),A(W,{key:0,size:"full",text:r.property.title?r.property.title.charAt(0).toUpperCase():"",class:"w-full h-full"},null,8,["text"])):(v(),y("img",{key:1,src:r.property.images[0],alt:r.property.title||"Property image",class:"w-full h-full object-cover"},null,8,H))]),m("div",K,[m("h3",Q,S(r.property.title||"Без названия"),1),m("div",X,[L(T,{class:"w-5 h-5 mr-1"}),m("span",null,S(r.property.location||"Не указано"),1)]),m("div",Y,S(p(r.property.price))+" ₽ ",1)]),N(g.$slots,"default",{},void 0)]))}},re=q(Z,[["__scopeId","data-v-9e08d888"]]);export{re as P,T as _,W as a,te as u};
